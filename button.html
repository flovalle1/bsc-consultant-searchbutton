<style>
    /* Floating Button */
    #fab {
        position: fixed;
        bottom: 20px;
        right: 20px;
        background-color: #1d4b73;
        color: white;
        border-radius: 50%;
        width: 60px;
        height: 60px;
        display: flex;
        justify-content: center;
        align-items: center;
        cursor: pointer;
        font-weight: bold;
        z-index: 9999;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        transition: background-color 0.3s;
    }

    #fab:hover {
        background-color: #173a59;
    }

    /* Slide-out Panel */
    #expert-panel {
        position: fixed;
        top: 0;
        right: -100%;
        width: 33%;
        height: 100%;
        background-color: #204060;
        color: white;
        box-shadow: -2px 0 6px rgba(0, 0, 0, 0.3);
        transition: right 0.3s ease;
        z-index: 9998;
        padding: 20px;
        display: flex;
        flex-direction: column;
        visibility: hidden;
    }

    #expert-panel.open {
        right: 0;
        visibility: visible;
    }

    /* Header */
    #expert-panel h2 {
        margin: 0 0 10px;
        font-size: 1.4rem;
    }

    /* Search Input */
    #expert-search {
        display: flex;
        margin-bottom: 15px;
    }

    #expert-search input {
        flex: 1;
        padding: 8px;
        border: none;
        border-radius: 4px 0 0 4px;
    }

    #expert-search button {
        background: white;
        border: none;
        border-radius: 0 4px 4px 0;
        padding: 8px 12px;
        cursor: pointer;
    }

    /* Consultant List */
    .consultant {
        background: #173a59;
        border-radius: 8px;
        padding: 10px;
        display: flex;
        align-items: center;
        margin-bottom: 10px;
        cursor: pointer;
        transition: background 0.2s;
    }

    .consultant:hover {
        background: #102840;
    }

    .consultant img {
        width: 50px;
        height: 50px;
        border-radius: 8px;
        margin-right: 10px;
        object-fit: cover;
    }

    .consultant-info {
        display: flex;
        flex-direction: column;
    }

    .consultant-name {
        font-weight: bold;
    }

    .consultant-address {
        font-size: 0.9rem;
        opacity: 0.8;
    }

    /* Loading State */
    .loading {
        text-align: center;
        padding: 20px;
        opacity: 0.7;
    }

    .error {
        text-align: center;
        padding: 20px;
        color: #ff6b6b;
        background-color: rgba(255, 107, 107, 0.1);
        border-radius: 4px;
        margin: 10px 0;
    }
</style>

<div id="fab">üîç</div>

<div id="expert-panel">
    <h2>Finde einen Experten in deiner N√§he!</h2>
    <div id="expert-search">
        <input type="text" id="search-input" placeholder="Name, Stadt oder PLZ">
        <button>üîç</button>
    </div>
    <div id="consultant-list"></div>
</div>

<script>
    (function () {
        let consultants = [];
        let isLoading = false;

        const fab = document.getElementById('fab');
        const panel = document.getElementById('expert-panel');
        const listContainer = document.getElementById('consultant-list');
        const searchInput = document.getElementById('search-input');

        // API-Funktionen
        async function fetchConsultants() {
            if (isLoading) return;

            isLoading = true;
            showLoading();

            try {
                console.log('Fetching consultants...');
                const response = await fetch('https://bsc-experten.de/wp-json/wp/v2/berater');

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                console.log('Received data:', data);

                consultants = data.map(consultant => {
                    console.log('Processing consultant:', consultant.title.rendered);
                    return {
                        name: consultant.title.rendered,
                        // Fallback auf einen Platzhalter wenn kein Bild verf√ºgbar ist
                        image: consultant.yoast_head_json?.og_image?.[0]?.url ||
                            'https://via.placeholder.com/150x150/1d4b73/ffffff?text=' + encodeURIComponent(consultant.title.rendered.charAt(0)),
                        link: consultant.link,
                        // Zus√§tzliche Informationen falls verf√ºgbar
                        id: consultant.id,
                        slug: consultant.slug
                    };
                });

                console.log('Processed consultants:', consultants);
                renderList();
            } catch (error) {
                console.error('Fehler beim Laden der Berater:', error);
                showError('Fehler beim Laden der Berater. Bitte versuchen Sie es sp√§ter erneut.');
            } finally {
                isLoading = false;
            }
        }

        function showLoading() {
            listContainer.innerHTML = '<div class="loading">Lade Berater...</div>';
        }

        function showError(message) {
            listContainer.innerHTML = `<div class="error">${message}</div>`;
        }

        function renderList(filter = "") {
            if (isLoading) return;

            console.log('Rendering list with filter:', filter);
            console.log('Available consultants:', consultants);

            listContainer.innerHTML = "";

            const filteredConsultants = consultants.filter(c =>
                c.name.toLowerCase().includes(filter.toLowerCase())
            );

            console.log('Filtered consultants:', filteredConsultants);

            filteredConsultants.forEach(c => {
                console.log('Creating element for:', c.name);

                const item = document.createElement('div');
                item.className = 'consultant';
                item.onclick = () => window.open(c.link, '_blank');

                // Fallback-Bild wenn das Laden fehlschl√§gt
                const imgElement = document.createElement('img');
                imgElement.src = c.image;
                imgElement.alt = c.name;
                imgElement.onerror = function () {
                    this.src = `https://via.placeholder.com/50x50/1d4b73/ffffff?text=${encodeURIComponent(c.name.charAt(0))}`;
                };

                const infoDiv = document.createElement('div');
                infoDiv.className = 'consultant-info';

                const nameDiv = document.createElement('div');
                nameDiv.className = 'consultant-name';
                nameDiv.textContent = c.name;

                const addressDiv = document.createElement('div');
                addressDiv.className = 'consultant-address';
                addressDiv.textContent = 'BSC | Die Finanzberater';

                infoDiv.appendChild(nameDiv);
                infoDiv.appendChild(addressDiv);

                item.appendChild(imgElement);
                item.appendChild(infoDiv);
                listContainer.appendChild(item);
            });

            // Zeige eine Nachricht wenn keine Ergebnisse gefunden wurden
            if (filteredConsultants.length === 0 && filter && consultants.length > 0) {
                const noResults = document.createElement('div');
                noResults.style.textAlign = 'center';
                noResults.style.padding = '20px';
                noResults.style.opacity = '0.7';
                noResults.textContent = 'Keine Berater gefunden.';
                listContainer.appendChild(noResults);
            }

            console.log('Render complete. List container children:', listContainer.children.length);
        }

        // Event Listeners
        fab.addEventListener('click', () => {
            panel.classList.toggle('open');

            // Wenn Panel ge√∂ffnet wird und keine Daten da sind, zeige die geladenen Daten
            if (panel.classList.contains('open') && consultants.length > 0) {
                renderList();
            }
        });

        searchInput.addEventListener('input', (e) => {
            renderList(e.target.value);
        });

        // Suchbutton Event Listener
        const searchButton = document.querySelector('#expert-search button');
        if (searchButton) {
            searchButton.addEventListener('click', () => {
                renderList(searchInput.value);
            });
        }

        // Lade Daten beim Seitenstart
        document.addEventListener('DOMContentLoaded', () => {
            console.log('Page loaded, fetching consultants...');
            fetchConsultants();
        });

        // Fallback falls DOMContentLoaded bereits gefeuert wurde
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', fetchConsultants);
        } else {
            console.log('Page already loaded, fetching consultants immediately...');
            fetchConsultants();
        }
    })();
</script>